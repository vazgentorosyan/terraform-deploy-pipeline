name: Terraform-deploy
on: workflow_dispatch
jobs:
  deploy:
    env:
      TF_DIR: terraform/infra
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
    runs-on: ubuntu-latest
    steps:
      - name: 'Get code'
        uses: actions/checkout@v3
      - name: 'Terraform init'
        run: cd ${{ env.TF_DIR }} && terraform init
      - name: 'Download artifacts'
        uses: actions/download-artifact@v3
        with:
          name: terraform-plan-file
      - name: 'Terraform deploy'
        run: cd ${{ env.TF_DIR }} && terraform plan
